name: Docker Image CI

on:
  push:
    branches: [ "master" ]
  pull_request:
    branches: [ "master" ]

jobs:
  build:
    runs-on: ubuntu-latest

    env: 
      ENV_PREFIX: ${{ secrets.ENV_PREFIX }} 
      ZAEMON_MONGODB_URI: ${{ secrets.ZAEMON_MONGODB_URI }} 
      ZAEMON_DB_NAME: ${{ secrets.ZAEMON_DB_NAME }} 
      ZAEMON_BOT_TOKEN: ${{ secrets.ZAEMON_BOT_TOKEN }} 
    
    steps:
    - uses: actions/checkout@v3
    - name: Build the Docker image
      run: |
        docker build \
          --build-arg ENV_PREFIX=${ENV_PREFIX} \
          --build-arg ZAEMON_MONGODB_URI=${ZAEMON_MONGODB_URI} \
          --build-arg ZAEMON_DB_NAME=${ZAEMON_DB_NAME} \
          --build-arg ZAEMON_BOT_TOKEN=${ZAEMON_BOT_TOKEN} \
          . --file Dockerfile --tag zaemon-bot:$(date +%s)
      
